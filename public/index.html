<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title>
    <%= htmlWebpackPlugin.options.title %>
  </title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
</head>

<body>
  <script type="text/javascript">
    window.languagePluginUrl = 'https://cdn.jsdelivr.net/pyodide/v0.16.1/full/';
  </script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js"
  async
  ></script>
  <script type="text/javascript" async >
    pythonCode = `
          def haha(*args, **kwargs):
              from dothttp import Config, HttpDefBase
              class content_override(HttpDefBase):
                def __init__(self, config: Config, **kwargs):
                    self.extra_kwargs = kwargs
                    super().__init__(config)
    
                def load_content(self):
                    self.original_content = self.content = self.extra_kwargs['content']
    
                def load_properties_n_headers(self):
                    self.property_util.add_env_property_from_dict(env=self.extra_kwargs.get("env", {}))
    
                def load_command_line_props(self):
                    for key, value in self.extra_kwargs.get("properties", {}).items():
                        self.property_util.add_command_property(key, value)
    
              def main(content):
                  out = content_override(
                      Config(target="1", no_cookie=True, property_file=None, experimental=False, format=False,
                            stdout=False, debug=False, info=False, curl=False, env=["hai"], file="", properties=[]),
                      env={"test": "google.com", },
                      content=content,
                  )
                  out.load()
                  out.load_def()
                  print(out.httpdef)
                  return out.httpdef
              globals()['main']=  main
          import micropip
          micropip.install(['textx', 'dothttp-req-wasm']).then(haha)
        `
    languagePluginLoader.then(() => {
      return pyodide.loadPackage(['micropip'])
    }).then(() => {
      pyodide.runPython(pythonCode);
    })

    function run(data) {
      pycode = 'main("""' + data + '""")';
      out = pyodide.runPython(pycode);

      console.log("method is ", out.method);
      console.log("url is ", out.url);
      console.log('headers are ', out.headers);
      console.log('urlparams are ', out.query);
      console.log("data is ", out.payload);
      console.log(out);
      return out;
    }
  </script>
  <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
        Please enable it to continue.</strong>
  </noscript>
  <div id="app"></div>
  <!-- built files will be auto injected -->
</body>

</html>